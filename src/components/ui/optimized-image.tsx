'use client';\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport Image from 'next/image';\nimport { useIntersectionObserver } from '@/hooks/useIntersectionObserver';\n\ninterface OptimizedImageProps {\n  src: string;\n  alt: string;\n  width?: number;\n  height?: number;\n  className?: string;\n  priority?: boolean;\n  quality?: number;\n  placeholder?: 'blur' | 'empty';\n  blurDataURL?: string;\n  sizes?: string;\n  fill?: boolean;\n  objectFit?: 'contain' | 'cover' | 'fill' | 'none' | 'scale-down';\n  objectPosition?: string;\n  loading?: 'lazy' | 'eager';\n  onLoad?: () => void;\n  onError?: () => void;\n  fallbackSrc?: string;\n  lazyLoad?: boolean;\n  aspectRatio?: string;\n  rounded?: boolean;\n  shadow?: boolean;\n}\n\n/**\n * Optimized image component with lazy loading, error handling, and performance optimizations\n */\nexport function OptimizedImage({\n  src,\n  alt,\n  width,\n  height,\n  className = '',\n  priority = false,\n  quality = 75,\n  placeholder = 'blur',\n  blurDataURL,\n  sizes,\n  fill = false,\n  objectFit = 'cover',\n  objectPosition = 'center',\n  loading = 'lazy',\n  onLoad,\n  onError,\n  fallbackSrc = '/images/placeholder.jpg',\n  lazyLoad = true,\n  aspectRatio,\n  rounded = false,\n  shadow = false,\n}: OptimizedImageProps) {\n  const [imageSrc, setImageSrc] = useState(src);\n  const [imageError, setImageError] = useState(false);\n  const [isLoaded, setIsLoaded] = useState(false);\n  const [shouldLoad, setShouldLoad] = useState(!lazyLoad || priority);\n  const imageRef = useRef<HTMLDivElement>(null);\n\n  // Use intersection observer for lazy loading\n  const { isIntersecting } = useIntersectionObserver({\n    elementRef: imageRef,\n    threshold: 0.1,\n    rootMargin: '50px',\n    freezeOnceVisible: true,\n  });\n\n  // Trigger loading when image comes into view\n  useEffect(() => {\n    if (isIntersecting && lazyLoad && !shouldLoad) {\n      setShouldLoad(true);\n    }\n  }, [isIntersecting, lazyLoad, shouldLoad]);\n\n  // Handle image load\n  const handleLoad = () => {\n    setIsLoaded(true);\n    onLoad?.();\n  };\n\n  // Handle image error\n  const handleError = () => {\n    if (!imageError && fallbackSrc && imageSrc !== fallbackSrc) {\n      setImageSrc(fallbackSrc);\n      setImageError(true);\n    }\n    onError?.();\n  };\n\n  // Generate blur data URL if not provided\n  const getBlurDataURL = () => {\n    if (blurDataURL) return blurDataURL;\n    \n    // Generate a simple blur data URL\n    return 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAABAAEDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAv/xAAhEAACAQMDBQAAAAAAAAAAAAABAgMABAUGIWGRkqGx0f/EABUBAQEAAAAAAAAAAAAAAAAAAAMF/8QAGhEAAgIDAAAAAAAAAAAAAAAAAAECEgMRkf/aAAwDAQACEQMRAD8AltJagyeH0AthI5xdrLcNM91BF5pX2HaH9bcfaSXWGaRmknyJckliyjqTzSlT54b6bk+h0R//2Q==';\n  };\n\n  // Build CSS classes\n  const containerClasses = [\n    'relative overflow-hidden',\n    aspectRatio && `aspect-[${aspectRatio}]`,\n    rounded && 'rounded-lg',\n    shadow && 'shadow-lg',\n    className,\n  ].filter(Boolean).join(' ');\n\n  const imageClasses = [\n    'transition-opacity duration-300',\n    isLoaded ? 'opacity-100' : 'opacity-0',\n    fill ? 'object-cover' : '',\n  ].filter(Boolean).join(' ');\n\n  // Placeholder component\n  const Placeholder = () => (\n    <div className=\"absolute inset-0 bg-gray-200 dark:bg-gray-700 animate-pulse flex items-center justify-center\">\n      <svg\n        className=\"w-8 h-8 text-gray-400 dark:text-gray-500\"\n        fill=\"currentColor\"\n        viewBox=\"0 0 20 20\"\n      >\n        <path\n          fillRule=\"evenodd\"\n          d=\"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z\"\n          clipRule=\"evenodd\"\n        />\n      </svg>\n    </div>\n  );\n\n  return (\n    <div ref={imageRef} className={containerClasses}>\n      {/* Show placeholder while not loaded */}\n      {!isLoaded && <Placeholder />}\n      \n      {/* Render image only when it should load */}\n      {shouldLoad && (\n        <Image\n          src={imageSrc}\n          alt={alt}\n          width={width}\n          height={height}\n          fill={fill}\n          sizes={sizes || (fill ? '100vw' : undefined)}\n          quality={quality}\n          priority={priority}\n          loading={priority ? 'eager' : 'lazy'}\n          placeholder={placeholder}\n          blurDataURL={placeholder === 'blur' ? getBlurDataURL() : undefined}\n          className={imageClasses}\n          style={{\n            objectFit: fill ? objectFit : undefined,\n            objectPosition: fill ? objectPosition : undefined,\n          }}\n          onLoad={handleLoad}\n          onError={handleError}\n        />\n      )}\n      \n      {/* Error state */}\n      {imageError && (\n        <div className=\"absolute inset-0 bg-gray-100 dark:bg-gray-800 flex items-center justify-center\">\n          <div className=\"text-center text-gray-500 dark:text-gray-400\">\n            <svg\n              className=\"w-8 h-8 mx-auto mb-2\"\n              fill=\"currentColor\"\n              viewBox=\"0 0 20 20\"\n            >\n              <path\n                fillRule=\"evenodd\"\n                d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z\"\n                clipRule=\"evenodd\"\n              />\n            </svg>\n            <p className=\"text-xs\">Failed to load</p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default OptimizedImage;\n"}